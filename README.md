# WireGuard VPN + Nginx Proxy + Let's Encrypt

–≠—Ç–æ—Ç `docker-compose`-–ø—Ä–æ–µ–∫—Ç —Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–µ—Ç –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è WireGuard VPN —Å –ø–æ–º–æ—â—å—é [wg-easy](https://github.com/WeeJeWel/wg-easy), —Å –¥–æ—Å—Ç—É–ø–æ–º —á–µ—Ä–µ–∑ –¥–æ–º–µ–Ω–Ω–æ–µ –∏–º—è –∏ HTTPS, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–¥–∞–≤–∞–µ–º—ã–º Let's Encrypt.

## üì¶ –°–µ—Ä–≤–∏—Å—ã

- **wg-easy** ‚Äî —É–¥–æ–±–Ω—ã–π –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ WireGuard.
- **nginx-proxy** ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–∫—Å–∏—Ä—É–µ—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è.
- **acme-companion** ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–ø—É—Å–∫–∞–µ—Ç –∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç TLS-—Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã –æ—Ç Let's Encrypt.

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ volumes

| –¢–æ–º             | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ                                      |
|------------------|--------------------------------------------------|
| etc_wireguard    | –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ WireGuard                           |
| nginx_data       | –î–∞–Ω–Ω—ã–µ Nginx                                     |
| nginx_conf       | –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Nginx                              |
| certbot_data     | TLS-—Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã Let's Encrypt                   |
| vhost_data       | –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã—Ö —Ö–æ—Å—Ç–æ–≤ Nginx           |
| html_data        | –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã, –¥–æ—Å—Ç—É–ø–Ω—ã–µ —á–µ—Ä–µ–∑ Nginx        |

‚öôÔ∏è –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

–ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:

git clone https://github.com/georgelucker/wg-easy-ssl.git
cd wg-easy-ssl

1. –£–∫–∞–∂–∏—Ç–µ –¥–æ–º–µ–Ω –∏ email

–û—Ç–∫—Ä–æ–π—Ç–µ docker-compose.yml –∏ –∑–∞–º–µ–Ω–∏—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è –Ω–∞ —Å–≤–æ–∏:

      - WG_HOST=vpn.your-domain.ru              # ‚Üê –≤–∞—à —Ä–µ–∞–ª—å–Ω—ã–π –¥–æ–º–µ–Ω
      - VIRTUAL_HOST=vpn.your-domain.ru         # ‚Üê —Ç–æ—Ç –∂–µ –∏–ª–∏ –¥—Ä—É–≥–æ–π –¥–æ–º–µ–Ω
      - LETSENCRYPT_HOST=vpn.your-domain.ru     # ‚Üê –¥–æ–º–µ–Ω –¥–ª—è HTTPS
      - LETSENCRYPT_EMAIL=yourmail@gmail.com    # ‚Üê –≤–∞—à–∞ –ø–æ—á—Ç–∞

‚ö†Ô∏è –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤–∞—à –¥–æ–º–µ–Ω —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ IP-–∞–¥—Ä–µ—Å —Å–µ—Ä–≤–µ—Ä–∞, –≥–¥–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —ç—Ç–æ—Ç compose.

2. –°–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ —Ö–µ—à –ø–∞—Ä–æ–ª—è

–ß—Ç–æ–±—ã –∑–∞–¥–∞—Ç—å –ø–∞—Ä–æ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –¥–ª—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ wg-easy, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å bcrypt-—Ö–µ—à. –í—ã –º–æ–∂–µ—Ç–µ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –µ–≥–æ —Ç–∞–∫:

docker run --rm -it ghcr.io/wg-easy/wg-easy:14 sh -c "node -e \"console.log(require('bcrypt').hashSync('–í–∞—à–ü–∞—Ä–æ–ª—å', 10))\""

–°–∫–æ–ø–∏—Ä—É–π—Ç–µ –ø–æ–ª—É—á–µ–Ω–Ω—É—é —Å—Ç—Ä–æ–∫—É –∏ –≤—Å—Ç–∞–≤—å—Ç–µ –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é PASSWORD_HASH –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π:

- PASSWORD_HASH=$2b$10$3kK...

3. –ó–∞–ø—É—Å–∫

–ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö, –∑–∞–ø—É—Å—Ç–∏—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã:

docker compose up -d

4. –û—Ç–∫—Ä–æ–π—Ç–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

–ß–µ—Ä–µ–∑ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ–∫—É–Ω–¥ –ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –æ—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ:

https://vpn.your-domain.ru

–í–æ–π–¥–∏—Ç–µ —Å –ø–∞—Ä–æ–ª–µ–º, –∫–æ—Ç–æ—Ä—ã–π –≤—ã –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–ª–∏ —Ä–∞–Ω–µ–µ.

5. –û—Å—Ç–∞–Ω–æ–≤–∫–∞

–ß—Ç–æ–±—ã –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏ —É–¥–∞–ª–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã:

docker compose down

‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Ä—Ç–æ–≤

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –æ—Ç–∫—Ä—ã—Ç—ã:

51820/udp ‚Äî WireGuard

80/tcp –∏ 443/tcp ‚Äî –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∏ —Ä–∞–±–æ—Ç—ã HTTPS-—Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤

üåç –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

Docker –∏ Docker Compose —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã

–î–æ–º–µ–Ω —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ IP-–∞–¥—Ä–µ—Å —Å–µ—Ä–≤–µ—Ä–∞

–°–µ—Ä–≤–µ—Ä –∏–º–µ–µ—Ç –≤—ã—Ö–æ–¥ –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç

üîÑ –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤

nginx-letsencrypt –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–¥–ª–µ–≤–∞–µ—Ç —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã –∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ—Ç –ø—Ä–æ–∫—Å–∏ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏. –ù–∏–∫–∞–∫–∏—Ö —Ä—É—á–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è.
